<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:body>
	<ui:composition template="/WEB-INF/template.xhtml">
		<ui:define name="metadata">
			<f:metadata>
				<f:viewParam name="lectureName" value="#{lectureBean.lectureName}" />
				<f:event listener="#{lectureBean.init}" type="preRenderView" />
			</f:metadata>
		</ui:define>
		<ui:define name="content">
			<h:panelGroup id="table_container" layout="block"></h:panelGroup>
			<!-- DO NOT REMOVE THIS -->

			<p:dialog widgetVar="replyDialog" header="Reply" modal="true"
				draggable="true" resizable="false"
				styleClass="custom-reply-dialog">
				<h:form>
					<h:inputTextarea value="#{lectureBean.content}" cols="43" rows="5"/>
					<div class="modal-footer">
						<p:commandButton value="Ok" action="#{lectureBean.reply()}"
							oncomplete="PF('replyDialog').hide()" styleClass="modal-button" />
						<p:commandButton value="Cancel"
							action="#{lectureBean.setCommentTitle(null)}"
							oncomplete="PF('replyDialog').hide()" styleClass="modal-button" />
					</div>
				</h:form>
			</p:dialog>

			<h2 style="margin-bottom: 20px;" class="sub-header">#{lectureBean.getLectureName()}
			
			<h:form style="font-size: 15px; float: right;">
			  <p:commandButton style="height: 43px;margin-right: 10px !important;width: 170px;" value="New Comment" action="#{commentBean.showDialog(lectureBean.getLectureName())}" styleClass="modal-button" title="Add a new comment"/>
			</h:form>
			</h2>
			
			<p:tabView>
				<p:tab title="Comments">
					<h:form>
						<ui:repeat var="comment"
							value="#{lectureBean.getLecture().getAllComments()}"
							varStatus="status">
							<h:panelGrid columns="2" cellspacing="10"
								columnClasses="comment-tab-feedback,">
								<h:panelGrid columns="2">
									<h:outputText value="#{comment.getStatistics().getLikeCount()}"
										styleClass="like-count" />
									<p:commandLink action="#{lectureBean.like(comment.getTitle())}">
										<h:graphicImage alt="UP" styleClass="up-button" name="up.png"
											library="images" title="Like" />
									</p:commandLink>

									<h:outputText
										value="#{comment.getStatistics().getDislikeCount()}"
										styleClass="dislike-count" />
									<p:commandLink
										action="#{lectureBean.dislike(comment.getTitle())}">
										<h:graphicImage alt="DOWN" styleClass="down-button"
											name="down.png" library="images" title="Dislike" />
									</p:commandLink>
								</h:panelGrid>


								<h:panelGrid columns="1">
									<h:outputText value="#{comment.getTitle()}" styleClass="comment-title" />
									<h:outputText value="#{comment.getContent()}" styleClass="comment-content"/>
									 
									<h:panelGrid columns="2" cellspacing="10" columnClasses=",comment-date-cell">
									  <p:commandLink value="Reply" 
									      action="#{lectureBean.setCommentTitle(comment.getTitle())}" 
									      oncomplete="PF('replyDialog').show()" styleClass="comment-reply" />
									   <h:outputText value="Edited on #{comment.getEditionDate().toString()}" styleClass="comment-date" />    
									</h:panelGrid>
								
									<ui:repeat var="subComment"
										value="#{comment.getAllSubComments()}">
										<hr />
										<h:outputText value="#{subComment.getContent()}" styleClass="comment-content"/>
										<div>
											<h:outputText
												value=" Edited on #{subComment.getEditionDate().toString()}" styleClass="comment-date"/>
										</div>

									</ui:repeat>
								</h:panelGrid>
							</h:panelGrid>
							<hr />
						</ui:repeat>
					</h:form>
				</p:tab>

				<p:tab title="Course Info">
					<h:outputText
						value="#{lectureBean.getLecture().getLectureDescription().getTextDescription()}" />
				</p:tab>
			</p:tabView>
		</ui:define>
	</ui:composition>
</h:body>
</html>