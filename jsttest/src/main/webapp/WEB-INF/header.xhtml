<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">
	
	<h:form id="form_id">
	   <h:commandLink action="index">
			<h:graphicImage id="logo_id" alt="Our Logo" styleClass="logo"
				name="logo.png" library="images" />
		</h:commandLink>
		
		<p:inputText id="search_bar_id" value="#{mainBean.searchQuery}" styleClass="search_bar" />
		<p:commandButton id="search_btn_id" value="Search" styleClass="button" action="#{mainBean.search()}" />
		
		<p:commandButton id="comment_btn_id" value="Comment" styleClass="button" action="#{commentBean.showDialog()}" title="Give a comment"/>  
		
		<p:commandButton id="rate_btn_id" value="Rate" styleClass="button" actionListener="#{ratingBean.showDialog()}" title="Rate a lecture"/> 
		
		<p:commandButton id="hidden_link" action="#{authenticationBean.retrieveLectureNames()}" style="display: none"/>
		
		<p:commandLink id="sign_in_id" action="#{authenticationBean.getAuthenticationURL()}" oncomplete="handleRedirection(xhr,status,args)">
		  <h:graphicImage id="sign_in" alt="Authhenticate" name="login.png" library="images" title="Authenticate" styleClass="sign"/>
		</p:commandLink>
		
		<p:commandLink id="sign_out_id" action="#{authenticationBean.signOut()}">
		  <h:graphicImage id="sign_out" alt="Sign out" name="logout.png" library="images" title="Unauthenticate" styleClass="sign"/>
		</p:commandLink>
	</h:form> 
	
	<ui:include src="/WEB-INF/commentDialog.xhtml" /> 
	<ui:include src="/WEB-INF/ratingDialog.xhtml" /> 
	<script>
	function handleRedirection(xhr,status,args){
		if(status == 'success'){
			  if(args.isRedirection){
				  window.blur();
				  //var url = document.getElementById('hidden_url').value;
				  var url = args.url;
				  //alert('ARGS ' + JSON.stringify(args));
				  var newWindow = window.open('','_blank');
				  newWindow.location= url;
				  newWindow.focus();
				  var link = document.getElementById('form_id:hidden_link');
				  link.click();
			  }  
		  }
	}
	</script>
</ui:composition>